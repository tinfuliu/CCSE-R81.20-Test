
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CCME 題庫練習</title>
<style>
  :root { --bg:#0b1020; --fg:#e7ebff; --card:#141a33; --muted:#99a2d0; --accent:#6aa0ff; }
  body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,Noto Sans,'Apple Color Emoji','Segoe UI Emoji'; background:var(--bg); color:var(--fg); }
  header { padding:18px 20px; border-bottom:1px solid #1f2748; position:sticky; top:0; background:linear-gradient(#0b1020,#0b1020cc); backdrop-filter: blur(4px); z-index:10; }
  h1 { font-size:20px; margin:0 0 6px 0; }
  .muted { color: var(--muted); }
  main { max-width: 1100px; margin: 24px auto; padding: 0 16px 40px; }
  .toolbar { display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:16px; }
  .toolbar > * { background: var(--card); border: 1px solid #1f2748; color: var(--fg); border-radius: 10px; padding:10px 12px; }
  select, input { outline:none; }
  button { cursor:pointer; transition: all .2s ease; }
  button:hover { transform: translateY(-1px); box-shadow: 0 4px 18px rgba(0,0,0,.25); }
  .card { background: var(--card); border:1px solid #1f2748; border-radius: 16px; padding:16px; margin:10px 0 18px; }
  .qhead { display:flex; justify-content:space-between; align-items:baseline; gap:10px; margin-bottom:8px; }
  .qid { font-weight:600; color:#cfd6ff; }
  .qstats { font-size:12px; color:#9ab0ff; }
  .qtxt { font-size:18px; line-height:1.45; white-space:pre-wrap; }
  .choices { display:grid; grid-template-columns:1fr; gap:8px; margin-top:10px; }
  .choice { border:1px solid #2a345f; border-radius:12px; padding:10px; cursor:pointer; }
  .choice.selected { border-color: var(--accent); background: #0d1530; }
  .choice.correct { border-color: #42cd7f; background: #0f2a1a; }
  .choice.wrong { border-color: #ff6b6b; background: #2a1111; }
  .choice.locked { opacity: .7; cursor: not-allowed; }
  .row { display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
  .pill { background:#0f1a3a; border:1px solid #2a345f; border-radius:999px; padding:6px 10px; font-size:12px; color:#cfd6ff; }
  .footer { display:flex; justify-content:space-between; align-items:center; gap:12px; }
  .btn { background: #203162; border:1px solid #40549b; color:white; border-radius:10px; padding:10px 14px; cursor:pointer; }
  .btn.secondary { background: transparent; border-color:#334279; color:#cfd6ff; }
  .btn.review { background:#2a2142; border-color:#7e5bef; }
  .btn.review.active { background:#3b2f6b; border-color:#a58bff; box-shadow: 0 0 0 2px rgba(165,139,255,.25) inset; }
  .btn.disabled { opacity: .5; cursor: not-allowed; }
  .danger { background:#3a1620; border-color:#a33; }
  .scoreBanner { background:#0f1a3a; border:1px solid #2a345f; border-radius:14px; padding:10px 12px; margin:10px 0; font-weight:600; }
  .searchBox { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
  .searchInput { width:240px; }
  .hidden { display:none; }
  .summary { display:flex; flex-direction:column; gap:6px; }
</style>
</head>
<body>
<header>
  <h1>CCTE 測驗 v1.1 <span class="muted">— 內嵌題庫</span></h1>
  <div class="muted" id="hdrMeta"></div>
</header>
<main>
  <section class="card">
    <div class="row">
      <div class="toolbar">
        <label>模式
          <select id="mode">
            <option value="exam">Exam（考試模式）</option>
            <option value="review_list">Review List（複習清單：隨機）</option>
            <option value="review_list_all">Review List（複習清單：全部）</option>
            <option value="search">Search（關鍵字找題）</option>
          </select>
        </label>
        <label id="countWrap">題數
          <select id="count">
            <option>5</option>
            <option>10</option>
            <option selected>20</option>
            <option>50</option>
            <option>100</option>
          </select>
        </label>
        <label id="rangeWrap">題號範圍
          <input id="rangeFrom" type="number" min="1" placeholder="起(如50)" style="width:90px" />
          <span>—</span>
          <input id="rangeTo" type="number" min="1" placeholder="迄(如100)" style="width:90px" />
        </label>
        <div class="searchBox" id="searchWrap">
          <input id="searchInput" class="searchInput" type="text" placeholder="關鍵字（多字詞以空白分隔）">
          <button class="btn secondary" id="searchBtn">搜尋</button>
          <button class="btn secondary" id="clearSearchBtn">清除</button>
        </div>
        <label><input type="checkbox" id="toggleOriginal"> 顯示原始題號</label>
        <button class="btn" id="startBtn">開始</button>
        <button class="btn secondary" id="resetBtn">重置複習清單/統計</button>
      </div>
      <div class="row">
        <div class="scoreBanner hidden" id="scoreBanner"></div>
      </div>
    </div>
  </section>

  <div id="quiz"></div>

  <section class="card hidden" id="footerCard">
    <div class="footer">
      <div>
        <button class="btn" id="prevBtn">上一題（←）</button>
        <button class="btn" id="confirmBtn">確認（Enter）</button>
        <button class="btn" id="nextBtn">下一題（→）</button>
        <button class="btn review" id="toggleReviewBtn">加入/移出複習清單（5）</button>
      </div>
      <div>
        <button class="btn" id="submitBtn">交卷（列出本次全部題）</button>
        <button class="btn secondary" id="exportReviewBtn">匯出複習清單ID</button>
      </div>
    </div>
  </section>
</main>
<script>
const BANK = [
  {
    "id": 1,
    "question": "What type of license is required for an MHO?",
    "choices": [
      "The MHO requires a NGTP license.",
      "The MHO requires a VSX license.",
      "The MHO does not require a license.",
      "A license is needed for each attached SGM."
    ],
    "answer": 2
  },
  {
    "id": 2,
    "question": "What happens when you make changes from Clish on the SMO Master?",
    "choices": [
      "The changes are synchronized to the SMS/MDS as a backup.",
      "The changes are synchronized to the MHO as a backup.",
      "Changes are only applied on the SMO Master.",
      "Changes are applied to all members in the SG."
    ],
    "answer": 2
  },
  {
    "id": 3,
    "question": "The _______ command will allow users to update the specified file on all SGMs.",
    "choices": [
      "g_update_conf_file",
      "g_all",
      "sed",
      "g_cat"
    ],
    "answer": 0
  },
  {
    "id": 4,
    "question": "What is the max amount of Orchestrators in Dual-site setup?",
    "choices": [
      "2 per Security Group",
      "4 per Security Group",
      "2",
      "4"
    ],
    "answer": 1
  },
  {
    "id": 5,
    "question": "There is a Security group of 10 Appliances and all of them are up and running. How many Appliances within a Security Group keep the same connection in its connection table in case of NAT?",
    "choices": [
      "Between 2 and 4",
      "All 10",
      "2",
      "3"
    ],
    "answer": 0
  },
  {
    "id": 6,
    "question": "Is it possible to define distribution mode per interface?",
    "choices": [
      "Yes, only for downlink interfaces",
      "No, only for the Security Group",
      "Yes, only for uplink interfaces",
      "Yes, for both uplink and downlink interfaces"
    ],
    "answer": 3
  },
  {
    "id": 7,
    "question": "What does asg monitor command do?",
    "choices": [
      "This command does not exist",
      "Monitor health status of entire system",
      "Monitor traffic on Appliances in Security Group",
      "Show real-time cluster status of Appliances in Security Group"
    ],
    "answer": 3
  },
  {
    "id": 8,
    "question": "How does HyperSync work in a Dual Site environment?",
    "choices": [
      "Each active connection has two local backups (on the local site) and a third backup connection on the second site (remote site.)",
      "Each active connection has a local backup (on the local site) and a second backup connection on the second site (remote site.)",
      "Each active connection has a local backup (on the local site) and a second backup connection on each of the MHOs.",
      "Each active connection has a backup connection on the second site (remote site.)"
    ],
    "answer": 1
  },
  {
    "id": 9,
    "question": "Layer 4 distribution is enabled by default in Maestro. Which is not a scenario when you would want to leave this enabled?",
    "choices": [
      "When there is a large number of source ports in use by protocols such as HTTP, HTTPS, and DNS.",
      "When dynamic routing protocols, such as BGP or OSPF are used.",
      "When there is a heavy imbalance of traffic between the SGMs that are members of the same SG.",
      "When the SG is NATing a very high percentage of traffic passing through it."
    ],
    "answer": 1
  },
  {
    "id": 10,
    "question": "There are two appliances within the same Security Group. One of them is connected by One downlink only, another one by Two downlinks. Assuming there no NAT and no VPN, what would be proportion of traffic distribution done by Orchestrator?",
    "choices": [
      "100%/0%",
      "33%/66%",
      "50%/50%",
      "66%/33%"
    ],
    "answer": 2
  },
  {
    "id": 11,
    "question": "What Maestro component acts as a load balancer and network switch?",
    "choices": [
      "Security Switching Module (SSM)",
      "Maestro Hyperscale Orchestrator (MHO)",
      "Security Group (SG)",
      "Security Gateway Module (SGM)"
    ],
    "answer": 1
  },
  {
    "id": 12,
    "question": "In a Maestro Dual Site environment, what is the definition of the term Active Site.",
    "choices": [
      "The Active Site is the site that is not handling any traffic for the specific SG, but itsconnections are synced to its SGMs from the MHOs to be ready in the event of a failover.",
      "The Active Site is the site where the SMO Master exists.",
      "There is no such thing as an active site. In a Dual Site environment, traffic is load balanced.",
      "The Active Site is the site currently handling the enforcement on traffic passing for a specific SG.Connections are synced within the SGMs in the Active Site."
    ],
    "answer": 3
  },
  {
    "id": 13,
    "question": "Which blade configuration files should be backed up on the SG if upgrading from R80.30SP or earlier?",
    "choices": [
      "IPS configuration files",
      "fwkern.conf files.",
      "VPN configuration files",
      "Mobile Access configuration files."
    ],
    "answer": 3
  },
  {
    "id": 14,
    "question": "Multiple SGs can exist in a Dual Site environment. Each SG can be configured in one of three ways. Which is not one of those ways?",
    "choices": [
      "Two MHOs connected to two MHOs via load balancers.",
      "Two MHOs at same site connected to remote site MHOs via two different switches.",
      "Two MHOs at same site connected to remote site MHOs via single switch.",
      "Direct connectivity between Remote Site MHOs."
    ],
    "answer": 0
  },
  {
    "id": 15,
    "question": "What cannot be a reason for \"Failed to get remote orchestrator interfaces\" error message, when clicking on\"Orchestrator\" in WebUI",
    "choices": [
      "Remote orchestrator has no empty interfaces",
      "Single orchestrator environment, but configured Orchestrator amount is 2",
      "One orchestrator only, but Orchestrator amount is 2 or no Sync in between orchestrators",
      "No Sync between orchestrators"
    ],
    "answer": 0
  },
  {
    "id": 16,
    "question": "What kinds of transceivers are supported on Orchestrator MHO-140?",
    "choices": [
      "SFP, QSFP, QSFP28",
      "SFP+, SFP28, QSFP",
      "SFP, SFP+, SFP28",
      "SFP, SFP+, QSFP, QSFP28"
    ],
    "answer": 3
  },
  {
    "id": 17,
    "question": "What can be learned from the output of sx_api_ports_dump.py command?",
    "choices": [
      "Information about backplane bonds",
      "Information about Security Groups",
      "Orchestrator port status",
      "Information about downlink ports only"
    ],
    "answer": 2
  },
  {
    "id": 18,
    "question": "What is the maximum number of Appliances within the same Security Group?",
    "choices": [
      "31",
      "8",
      "52",
      "16"
    ],
    "answer": 0
  },
  {
    "id": 19,
    "question": "What is a security group?",
    "choices": [
      "A solution for Security Gateway redundancy and Load Sharing.",
      "A set of appliances of the same model that are collectively managed by the MHO.",
      "A set of network interfaces and individual SGMs assigned to a logical group.",
      "A set of objects in SmartConsole that are responsible for enforcing an access policy."
    ],
    "answer": 0
  },
  {
    "id": 20,
    "question": "Which command do you use to find bottlenecks in the system that are affecting performance, even functionality in some cases?",
    "choices": [
      "asg stat -v",
      "asg diag verify",
      "asg perf -v",
      "asg monitor"
    ],
    "answer": 2
  },
  {
    "id": 21,
    "question": "Which distribution mode assigns packets to an SGM based solely on the packet destination IP?",
    "choices": [
      "User mode",
      "Manual mode",
      "Network mode",
      "Auto-topology mode"
    ],
    "answer": 2
  },
  {
    "id": 22,
    "question": "What is the difference between Dual-Site and Dual-Room?",
    "choices": [
      "Dual-Room is a kind of Dual-Site deployment within the same building",
      "Dual-Room is Active / Standby and Dual-Site is Active / Active",
      "Dual-Room is a Single-Site deployment where all Appliances are connected to both orchestrators",
      "They are the same"
    ],
    "answer": 0
  },
  {
    "id": 23,
    "question": "In case of Correction, where is information about Owner stored?",
    "choices": [
      "In Correction table of Target Appliance",
      "In Connection tables of all Appliances participating in Correction Layer flow",
      "In Correction tables of all Appliances participating in Correction Layer flow",
      "In Connection table of Target Appliances"
    ],
    "answer": 1
  },
  {
    "id": 24,
    "question": "While looking at your system correction statistics, you notice you have a correction rate approaching 100 percent. Is this a problem?",
    "choices": [
      "A correction rate above 90 percent indicates a need to disable Layer 4 Distribution.",
      "A correction rate approaching 100 percent of all connections is unusual. This is a cause for concern because the SGMs may fail to process traffic.",
      "If correction rates are higher than 80 percent, latency is expected.",
      "In some scenarios, a correction rate approaching 100 percent of all connections is not unusual. This is not usually a cause for concern as the correction mechanism is fast and efficient."
    ],
    "answer": 3
  },
  {
    "id": 25,
    "question": "After you import the R81.10 software package, what do you use to verify that it is possible to upgrade an MHO or SG?",
    "choices": [
      "Run HCP. One of the tests will list upgrade eligibility status for the MHO or SG.",
      "Run the Pre-Upgrade Verifier to make sure it is possible to upgrade",
      "Nothing. CPUSE will run a verification during the upgrade process to ensure the package is compatible.",
      "The package is verified during the import process and a warning or error will be displayed at that time."
    ],
    "answer": 1
  },
  {
    "id": 26,
    "question": "What is the maximum number of Appliances within Security group in Dual-Site configuration?",
    "choices": [
      "28",
      "31",
      "15",
      "16"
    ],
    "answer": 0
  },
  {
    "id": 27,
    "question": "What is the purpose of RJ-45 connectors located at the front panel of the Orchestrator MHO- 170?",
    "choices": [
      "Two Out-of-band interfaces for access to Orchestrator itself",
      "1Gbps connectivity for Security Groups",
      "Out-of-band interface for access to Orchestrator itself and Serial Console connector",
      "Reserved for internal purposes. Not in use"
    ],
    "answer": 2
  },
  {
    "id": 28,
    "question": "What happens if you apply a hotfix using gClish?",
    "choices": [
      "If you apply a hotfix using gclish, it causes an outage for the entire SG as all members reboot at roughly the same time.",
      "If you apply a hotfix using gclish, each SG members installs the hotfix and reboots after waiting it turn to do so.",
      "Logical groups \"A\" and \"B\" are created. Members of group \"A\" install and reboot first. Then members of group \"B\" does the same once reboots have finished with group \"A.\"",
      "If you apply a hotfix using gclish, the operation will fail because an outage would occur."
    ],
    "answer": 1
  },
  {
    "id": 29,
    "question": "Which command should be used to restart Orchestrator service only?",
    "choices": [
      "orchd restart",
      "reboot",
      "service orchestrator restart",
      "cpstop; cpstart"
    ],
    "answer": 0
  },
  {
    "id": 30,
    "question": "What command can be run to show which SGM is selected to receive traffic?",
    "choices": [
      "g_tcpdump",
      "asg monitor",
      "dxl calc",
      "asg calc"
    ],
    "answer": 3
  },
  {
    "id": 31,
    "question": "When a VPN tunnel is formed with a Maestro SGM,",
    "choices": [
      "The receiving SGM makes an encryption decision. The SGM then syncs the traffic to two backup SGMs: one for clear traffic and one for encrypted traffic.",
      "SGM 1 analyzes the policy and topology. If encryption is required, it calculates the tunnel owner IP address. SGM 1 sends a clear packet to the tunnel owner. SGM 2 is now the connectionand tunnel owner.",
      "The MHO handles the IKE before distributing the traffic to a SGM to handle all encrypted traffic. This helps to prevent any issues with the correction layer.",
      "The MHO distributes copies of the packets to two different SGMs because SGM 1 will handle the clear traffic IKE exchange packets, while SGM2 handles encrypted packets."
    ],
    "answer": 1
  },
  {
    "id": 32,
    "question": "Logs without a dedicated log file can be found in",
    "choices": [
      "/var/log/junk.log.dbg",
      "/var/log/messages",
      "$RTDIR/log/junk.log",
      "$FWDIR/log/fw.log"
    ],
    "answer": 1
  },
  {
    "id": 33,
    "question": "What is the Orchestrator?",
    "choices": [
      "Network Switch",
      "Manager of compute and network resources, load balancer and network switch",
      "Load balancer",
      "None of above"
    ],
    "answer": 1
  },
  {
    "id": 34,
    "question": "What is an uplink interface used for?",
    "choices": [
      "To connect in between appliances",
      "To connect appliances to customer infrastructure",
      "To connect Orchestrators to customer infrastructure",
      "To connect in between Orchestrators"
    ],
    "answer": 2
  },
  {
    "id": 35,
    "question": "Complete the sentence: Dual Orchestrators work as.______",
    "choices": [
      "Load Sharing cluster",
      "Active-Active cluster",
      "Active - Standby cluster",
      "Hot-Swap RAID"
    ],
    "answer": 1
  },
  {
    "id": 36,
    "question": "What Maestro component is automatically designated the SMO Master?",
    "choices": [
      "The SGM with the lowest member ID (the first one added to the security group.)",
      "The MDS that pushes policy to the SMO is considered the SMO Master.",
      "The first MHO configured is considered the SMO Master.",
      "The SGM with the highest member ID (the last one added to the security group.)"
    ],
    "answer": 0
  },
  {
    "id": 37,
    "question": "There are two 10Gbps dual-port NIC installed on a 6800 appliance. Which interfaces should be connected to Orchestrator 1 for downlinks'' intra-orchestrator redundancy when using two Orchestrators?",
    "choices": [
      "Any pair of available ports",
      "Port1 in Slot1 and Port1 in Slot2",
      "Port1 in Slot1 and Port2 in Slot1",
      "Port1 in Slot2 and Port2 in Slot1"
    ],
    "answer": 1
  },
  {
    "id": 38,
    "question": "How many orchestrators may Dual-Site include?",
    "choices": [
      "2or4",
      "2",
      "1",
      "Only 4"
    ],
    "answer": 0
  },
  {
    "id": 39,
    "question": "For the MHO-175, which ports are Management ports?",
    "choices": [
      "Ports 49 - 55 are Management ports.",
      "Ports 1 - 4 are Management ports.",
      "Ports 27 - 47 are Management ports.",
      "Ports 5 - 26 are Management ports."
    ],
    "answer": 1
  },
  {
    "id": 40,
    "question": "To display processes that are consuming excessive system resources, users should use the_____ command.",
    "choices": [
      "asg perf -v",
      "asg stat -v",
      "top",
      "asg_perf_hogs"
    ],
    "answer": 3
  },
  {
    "id": 41,
    "question": "What is the Correction Layer mechanism?",
    "choices": [
      "Ensures asymmetric traffic is handled properly, especially in the case of NAT or VPNs.",
      "The load-balancing mechanism used by the MHO.",
      "The MHO distribution algorithm which determines the handling SGM for a given connection.",
      "Enforces the access policy on the SGMs and synchronizes the enforcement verdict to other SGMs in the SG."
    ],
    "answer": 0
  },
  {
    "id": 42,
    "question": "splitter cannot be used _______.",
    "choices": [
      "To connect single port on orchestrator to the same Appliance",
      "To connect single port on orchestrator to multiple port on external switch",
      "To connect single port on Appliance to multiple ports on the orchestrator",
      "To connect single port on orchestrator to multiple Appliances"
    ],
    "answer": 2
  },
  {
    "id": 43,
    "question": "Which feature is used to force trusted non-F2F traffic into the fully accelerated path for handling by SecureXL.",
    "choices": [
      "Fast Accelerator",
      "hypersync",
      "rate limiting",
      "SecureXL"
    ],
    "answer": 3
  },
  {
    "id": 44,
    "question": "Which command is used to set the number of sites in a Maestro environment?",
    "choices": [
      "set maestro orchestrator-site-amount",
      "set maestro configuration orchestrator-site-amount",
      "set maestro configuration orchestrator-site-number",
      "set maestro configuration orchestrator-site-id"
    ],
    "answer": 1
  },
  {
    "id": 45,
    "question": "In what mode do MHOs process traffic?",
    "choices": [
      "MHOs process traffic in load sharing mode",
      "MHOs process traffic in Active-Standby mode",
      "MHOs process traffic in Active-Active mode",
      "MHOs process traffic in VSLS mode"
    ],
    "answer": 2
  },
  {
    "id": 46,
    "question": "There are two 10Gbps dual-port NICs and one 40Gbps NIC installed on a 23800 Appliance in slots 1, 2 and 3 accordingly. Which interfaces should be connected to Orchestrator 1 for downlinks'' intra- orchestrator redundancy when using two Orchestrators?",
    "choices": [
      "Port1 in Slot2 and Port2 in Slot1",
      "This configuration is not supported",
      "Any pair of available ports",
      "Port1 in Slot1 and Port2 in Slot1"
    ],
    "answer": 3
  },
  {
    "id": 47,
    "question": "What type of cluster can a Security Group can be compared to?",
    "choices": [
      "Load Sharing Active / Active",
      "VSLS",
      "Active / Backup",
      "Active / Standby"
    ],
    "answer": 0
  },
  {
    "id": 48,
    "question": "In a dual MHO environment, MHO1 and MHO2 are connected to the SGM line cards in which way?",
    "choices": [
      "MHO1 and MHO2 are connected to the SGMs using the Sync cable.",
      "MHO1 and MHO2 are connected to the line cards in any order administrators see fit.",
      "MHO 1 is connected to the even-numbered ports, while MHO2 is connected to odd-numbered ports.",
      "MHO 1 is connected to the odd-numbered ports, while MHO2 is connected to even-numbered ports."
    ],
    "answer": 3
  },
  {
    "id": 49,
    "question": "When working with Maestro, what is the difference between using Clish and gClish?",
    "choices": [
      "Clish commands are for testing purposes only and cannot be saved, gClish commands apply to all SG members, by default.",
      "Clish commands apply to all UP SG members, by default. gClish commands apply to all SG members, by default.",
      "Clish commands are run on the SG members. gClish commands are run on the MHO and applied to all connected SG members in a specified group.",
      "Clish commands apply only to a specific SG member. gClish commands apply to all UP SG members, by default."
    ],
    "answer": 3
  },
  {
    "id": 50,
    "question": "What is the purpose of g_tcpdump command?",
    "choices": [
      "Collects traffic dump from Sync network",
      "Collects traffic dump from CIN network",
      "The same as tcpdump, just on Scalable Platform",
      "Collects traffic dump from all Active Appliances within Security Group"
    ],
    "answer": 3
  },
  {
    "id": 51,
    "question": "What kinds of transceivers are supported on Orchestrator MHO-170?",
    "choices": [
      "SFP, QSFP, QSFP28",
      "SFP+, SFP28, QSFP",
      "SFP, SFP+, SFP28",
      "QSFP, QSFP28"
    ],
    "answer": 3
  },
  {
    "id": 52,
    "question": "The drop_monitor command is useful for",
    "choices": [
      "Monitoring Check Point code drops",
      "Viewing all interface drops such as RX-ERR, RX-DRP, and RX-OVR",
      "Viewing all drops by Check Point code or the Gaia OS, such as RX-DRP, RX-ERR, and Gaia OS drops.",
      "Showing the system temperature in real-time for multiple components, such as CPU, fan, and SSDs."
    ],
    "answer": 2
  },
  {
    "id": 53,
    "question": "What is one benefit of a Dual MHO environment?",
    "choices": [
      "Dual MHOs provide redundancy to the Maestro environment by increasing throughput by at least 50 percent.",
      "Dual MHOs allow better synchronization to occur between SGMs.",
      "Dual MHOs allow additional SGMs to be added to the SG.",
      "Dual MHOs can be used to achieve increased scalability and redundancy."
    ],
    "answer": 3
  },
  {
    "id": 54,
    "question": "What will happen in case of NAT of the traffic passing through Management network?",
    "choices": [
      "This traffic will not pass correction, since it will be dropped",
      "Orchestrator will disable NAT and traffic will pass with no issue",
      "Since Management traffic is always going to SMO, it will take a care for Correction Layer and will re-distribute traffic to other Appliances",
      "This traffic will pass with no inspection"
    ],
    "answer": 0
  },
  {
    "id": 55,
    "question": "What is the Correction Layer?",
    "choices": [
      "Correction Layer is a daemon which corrects errors on Backplane interfaces",
      "Correction Layer is a mechanism which handles asymmetric connections in multi-appliance system. For example, in case of NAT",
      "Correction Layer is a mechanism which activated in case of asymmetric routing",
      "Correction Layer is a Layer of GAIA OS which corrects misspelled commands and allows them to execute"
    ],
    "answer": 1
  },
  {
    "id": 56,
    "question": "What is the command 'asg diag' used for?",
    "choices": [
      "Asg diag used for system diagnostics on Chassis only. It does not exist on Maestro",
      "Asg diag is used for system backup",
      "Asg diag is used for system diagnostics",
      "Asg diag"
    ],
    "answer": 2
  },
  {
    "id": 57,
    "question": "The core four manual diagnostic tools include:\nasg diag verify, asg perf -v, orch_stat -all, and",
    "choices": [
      "asg diag verify",
      "cpinfo",
      "hcp -r all",
      "asg stat -v"
    ],
    "answer": 2
  },
  {
    "id": 58,
    "question": "Where should sx_api_ports_dump.py command be ran?",
    "choices": [
      "Management server",
      "Security Group",
      "Orchestrator",
      "SMO Appliance"
    ],
    "answer": 2
  },
  {
    "id": 59,
    "question": "What is the throughput penalty of Security Group?",
    "choices": [
      "Depends on the type of Appliance",
      "1% per member",
      "10% per Security Group with no relation to the number of members",
      "5% per member"
    ],
    "answer": 1
  },
  {
    "id": 60,
    "question": "Do all MHOs need to be upgraded before starting the SGM upgrades?",
    "choices": [
      "During the upgrade process all SGMs should be upgraded before upgrading all of the MHOs.",
      "A minimum of one of the MHOs should be upgraded before starting the SGM upgrades. However, there is no requirement to upgrade all the SGMs during the same maintenance window as the MHO",
      "All MHOs must first be upgraded before starting the SGM upgrades However, there is no requirement to upgrade all the SGMs during the same maintenance window as the MHOs.",
      "MHOs do not need to be upgraded at all because Maestro supports the use of different versions between the MHOs and SGMs."
    ],
    "answer": 2
  },
  {
    "id": 61,
    "question": "Possibilities for a failure in a single SGM of a Security Group include",
    "choices": [
      "A change was made with clish instead of gClish, causing the SGM to handle traffic differently than the other SGMs.",
      "SecureXL is not enabled on the SGM.",
      "An administrator imported a hotfix into the CPUSE repository of a single SGM.",
      "There are too many active SGMs in the SG."
    ],
    "answer": 2
  },
  {
    "id": 62,
    "question": "What is the default Distribution mode?",
    "choices": [
      "Auto-topology",
      "User",
      "Manual-General",
      "Network"
    ],
    "answer": 0
  },
  {
    "id": 63,
    "question": "Maestro allows running commands globally in Expert mode by using global prefixes, such as:",
    "choices": [
      "asg all",
      "g_all",
      "all",
      "global"
    ],
    "answer": 1
  },
  {
    "id": 64,
    "question": "When security policy is installed",
    "choices": [
      "All SGMs receive the security policy and one by one performs an independent policy verification. Then, all SGMs simultaneously install the policy.",
      "The SMO Master receives the policy and performs a policy verification the policy is installed on the SMO Master, the SMO Master broadcasts the available package, other members retrieve the new policy from the SMO Master, then the non-SMO Master SGMs install the policy.",
      "All SGMs receive the security policy and simultaneous policy installation occurs.",
      "The policy is installed on the SMO, the SMO Master broadcasts the available package, other members retrieve the new policy from the SMO Master and perform an independent policy verification, then the non-SMO Master SGMs install the policy."
    ],
    "answer": 3
  },
  {
    "id": 65,
    "question": "Which licenses should be issued for the Orchestrator?",
    "choices": [
      "No licenses are required for Orchestrator",
      "Depends on Software Blades enabled on connected appliances",
      "The Orchestrator is considered a Management server, hence it licensed the same way",
      "The Orchestrator requires NGTX license"
    ],
    "answer": 0
  },
  {
    "id": 66,
    "question": "What is a downlink interface used for?",
    "choices": [
      "To connect appliances to Orchestrators",
      "To connect appliances to customer infrastructure",
      "To connect in between Orchestrators",
      "To connect Orchestrators to customer infrastructure"
    ],
    "answer": 0
  },
  {
    "id": 67,
    "question": "What does the lldpctl command do?",
    "choices": [
      "Show all devices discovered by LLDP protocol on downlink ports",
      "Show all devices discovered by LLDP protocol on all ports",
      "Discover orchestrator",
      "Show all devices discovered by LLDP protocol on uplink ports"
    ],
    "answer": 1
  },
  {
    "id": 68,
    "question": "What is the purpose of g_tcpdump command?",
    "choices": [
      "Collects traffic dump from all Active Appliances within Security Group",
      "Collects traffic dump from CIN network",
      "Collects traffic dump from Sync network",
      "The same as tcpdump, just on Scalable Platform"
    ],
    "answer": 0
  },
  {
    "id": 69,
    "question": "What cannot be learned from the output of lldpctl?",
    "choices": [
      "Serial number of Appliance",
      "Appliance model",
      "Distribution mode",
      "Orchestrator IP"
    ],
    "answer": 2
  },
  {
    "id": 70,
    "question": "HealthCheck Point _____",
    "choices": [
      "is a self-updatable suite of tools for MHOs with the capability to assess the health of the system\nand provide a timeline of critical and informative events that might have occurred in a production system.",
      "performs a system health check and is meant to replace both a CPInfo and the health check script.",
      "can be used to let you visualize the Firewall topology for the SG and view live statistics, which includes throughput, problem notes, and CPU utilization.",
      "is a self-updatable suite of tools for SGMs with the capability to assess the health of the system, visualize the Firewall topology, provide a timeline of critical and informative events that might have occurred in a production system."
    ],
    "answer": 3
  },
  {
    "id": 71,
    "question": "At a minimum, how many management and Uplink ports does a SG require?",
    "choices": [
      "Only one of the two interfaces is needed for the Security Group.",
      "Neither are required.",
      "Two of each.",
      "One each."
    ],
    "answer": 3
  },
  {
    "id": 72,
    "question": "What happens if the SMO Master fails?",
    "choices": [
      "The next SGM with the current lowest SGM ID assumes the role of the SMO Master.",
      "The Backup SMO Master will take over in the event of a failure with the SMO Master.",
      "A failover will occur on the MHO and traffic will continue to pass.",
      "The Security Group will no longer pass traffic and the issue must be resolved with the SMO Master."
    ],
    "answer": 0
  },
  {
    "id": 73,
    "question": "During an upgrade, Is Multi-Version Clustering (MVC) supported?",
    "choices": [
      "No. Maestro does not support MVC because ClusterXL is disabled during an upgrade.",
      "No, Maestro does not support MVC.",
      "Maestro supports MVC or full connectivity upgrade as of R80.40.",
      "Yes, MVC is supported as of R81 for Maestro."
    ],
    "answer": 3
  },
  {
    "id": 74,
    "question": "What command should be used for collecting diagnostic information about the orchestrator?",
    "choices": [
      "cpinfo",
      "asg perf -v",
      "cpview",
      "orch_info"
    ],
    "answer": 3
  },
  {
    "id": 75,
    "question": "What is the purpose of Management ports located on the Rear Panel of the Orchestrator MHO-140?",
    "choices": [
      "1Gbps connectivity for Security Groups",
      "Reserved for internal purposes. Not in use.",
      "Out-of-band interfaces for access to Orchestrator itself",
      "Additional ports used as uplinks"
    ],
    "answer": 2
  },
  {
    "id": 76,
    "question": "For a VSX configuration – Which statement is wrong?",
    "choices": [
      "All Virtual Systems exist on the SMO",
      "All Virtual Systems exist on all Appliances",
      "VSX configuration is the same on all Appliances within the same Security Group",
      "Each Appliance owns different Virtual Systems"
    ],
    "answer": 3
  },
  {
    "id": 77,
    "question": "One single Appliance supports 1M concurrent connections. How many concurrent connections will support Security Group of 2 Appliances?",
    "choices": [
      "2M",
      "500K",
      "4M",
      "1M"
    ],
    "answer": 0
  },
  {
    "id": 78,
    "question": "What kind of cluster Dual-Site can be compared to?",
    "choices": [
      "Active-Standby or VSLS",
      "VSLS only",
      "Active-Active",
      "Active-Standby only"
    ],
    "answer": 0
  },
  {
    "id": 79,
    "question": "There a 23800 appliance with quad NIC in slot 5. What would be the name of port 3 on this NIC?",
    "choices": [
      "ethBP3-05",
      "ethsBP5-03",
      "ethsBP3-05",
      "ethsBP-05"
    ],
    "answer": 1
  },
  {
    "id": 80,
    "question": "What is the basic installation sequence of the Orchestrator in case of single Orchestrator?\n\n#1. Create a Security Group\n#2. Configure Default Gateway\n#3. Connect with Serial Console cable to the Orchestrator\n#4. Configure IP for one of its Management interfaces\n#5. Connect an appliance to a downlink port\n#6. Change Orchestrator amount to 1\n#7. Browse to the Orchestrator’s WebUI",
    "choices": [
      "3-4-2-6-5-7-1",
      "3-1-7-2-4-6-5",
      "1-4-2-5-7-3-6",
      "7-4-2-5-3-1-6"
    ],
    "answer": 0
  },
  {
    "id": 81,
    "question": "Orchestrator should be defined in SmartConsole as:",
    "choices": [
      "Orchestrator is not defined in SmartConsole",
      "Check Point host",
      "Security Gateway",
      "Host"
    ],
    "answer": 0
  },
  {
    "id": 82,
    "question": "How many power supplies are presented on MHO-140?",
    "choices": [
      "2",
      "4",
      "1",
      "1 with option for 2"
    ],
    "answer": 0
  },
  {
    "id": 83,
    "question": "What is the default range of physical ports for downlinks on Orchestrator MHO-140?",
    "choices": [
      "25 - 47",
      "27 - 47",
      "1 - 48",
      "1 - 25"
    ],
    "answer": 1
  },
  {
    "id": 84,
    "question": "What is the Iterator process?",
    "choices": [
      "Iterator is the process that simulates distribution in case of Appliance failure",
      "Iterator is the process that follow Appliance recovery and simulates what was a distribution if recovered Appliance was alive",
      "Iterator is the process that runs on the Orchestrator and calculates a distribution in case of Appliance failure",
      "Iterator is the process that runs on the Orchestrator and calculates a distribution in case of Appliance recovery"
    ],
    "answer": 1
  },
  {
    "id": 85,
    "question": "Which is a valid requirement for a supported Maestro appliance?",
    "choices": [
      "10GBps and 40Gbps or 100Gbps card with double-VLAN and LLDP support",
      "At least one 10GBps line card",
      "Nothing special as Maestro supports any Check Point appliance",
      "Line card with double-VLAN and LLDP support"
    ],
    "answer": 1
  },
  {
    "id": 86,
    "question": "Which setting is required in order to connect an appliance with 40Gbps downlink interface and DAC to the Orchestrator MHO-140?",
    "choices": [
      "On Orchestrator: Change QSFP mode from 100Gbps to 40Gbps",
      "On Orchestrator: Change port type from uplink to downlink",
      "On Appliance: Change a port speed to 10Gbps",
      "No change required"
    ],
    "answer": 1
  },
  {
    "id": 87,
    "question": "In case of VSX: What is the right command to see overall performance details of all Appliances within the Security Group and all Virtual Systems?",
    "choices": [
      "asg pert -v -p",
      "asg pert -vs all -v -vv",
      "asg pert -v",
      "asg pert -vs enabled -p"
    ],
    "answer": 1
  },
  {
    "id": 88,
    "question": "When running asg perf -v in a Dual-Site environment, we can see only Appliances from one of the sites. That means we’re working in:",
    "choices": [
      "VSLS mode",
      "Active / Active",
      "Active / Standby HA mode",
      "This is not Dual-Site, in Dual-Site we always see Appliances from both sites"
    ],
    "answer": 2
  },
  {
    "id": 89,
    "question": "How many power supplies are presented on MHO-170?",
    "choices": [
      "2",
      "1",
      "1 with option for 2",
      "4"
    ],
    "answer": 0
  },
  {
    "id": 90,
    "question": "On MHO-170 – In default configuration, what are GAIA names of Security Group Management ports?",
    "choices": [
      "eth1-Mgmt1 and eth1-Mgmt2",
      "eth1-Mgmt1 and eth2-Mgmt1",
      "eth1-Mgmt1 and eth1-Mgmt3",
      "eth1-Mgmt3 and eth1-Mgmt4"
    ],
    "answer": 2
  },
  {
    "id": 91,
    "question": "What is a Security Group?",
    "choices": [
      "Logical group of computer and network resources",
      "Group of security administrators",
      "Group of security gateways",
      "Group of appliances with enabled NGTX software blades"
    ],
    "answer": 2
  },
  {
    "id": 92,
    "question": "What command will be used for updating fwkern.conf file on all Appliances within Security Group?",
    "choices": [
      "g_update_conf_file",
      "g_update_kernel",
      "vi",
      "g_all update_conf_file"
    ],
    "answer": 0
  },
  {
    "id": 93,
    "question": "What is the default range of physical ports for downlinks on Orchestrator MHO-170?",
    "choices": [
      "3 - 16",
      "17 - 31",
      "25 - 32",
      "1 - 16"
    ],
    "answer": 1
  },
  {
    "id": 94,
    "question": "What is the minimal amount of cables needed in order to connect an Appliance to an Orchestrator?",
    "choices": [
      "Three cables: uplink, downlink, SYNC",
      "One Downlink cable only",
      "Two cables: one uplink and one downlink",
      "Four cables: uplink, downlink, SYNC and Management"
    ],
    "answer": 1
  },
  {
    "id": 95,
    "question": "What cannot be learned from the output of asg perf -v -p command?",
    "choices": [
      "Average CPU usage on Appliances",
      "Real-time throughput",
      "Average CPU usage on Orchestrators",
      "Per-path distribution"
    ],
    "answer": 2
  },
  {
    "id": 96,
    "question": "What is the distribution mode?",
    "choices": [
      "Distribution mode is the same as QSFP mode",
      "Distribution mode is how the Orchestrator distributes traffic in between Security Groups",
      "Distribution mode means selected algorithm for traffic distribution in between Orchestrators",
      "Distribution mode means selected algorithm for traffic distribution in between Appliances"
    ],
    "answer": 3
  },
  {
    "id": 97,
    "question": "What does the command'g_all' do?",
    "choices": [
      "It followed by other command and execute it on all active Appliances within Security Group",
      "It followed by other command and execute it on all Appliances connected to Orchestrator",
      "Switches all Appliances to Global mode",
      "Bring up all Appliances"
    ],
    "answer": 0
  },
  {
    "id": 98,
    "question": "Which file on Appliance includes information about Security Group?",
    "choices": [
      "/etc/chassisdb.json",
      "/etc/sgdb.json",
      "/etc/smodb.json",
      "/etc/distutil.json"
    ],
    "answer": 1
  },
  {
    "id": 99,
    "question": "Complete the sentence: Orchestrators works as...",
    "choices": [
      "Active-Active cluster",
      "Hot-Swap RAID",
      "Active-Standby cluster",
      "Load Sharing cluster"
    ],
    "answer": 0
  },
  {
    "id": 100,
    "question": "In order to set Site (chassis) priority per VS, following command should be used:",
    "choices": [
      "From given VS context: set chassis high-availability vs chassis_priority",
      "From given VS0 context: set chassis high-availability vs chassis_priority",
      "From any VS context: set chassis high-availability vs chassis_priority",
      "From VS0 context: set chassis high-availability vs chassis_priority"
    ],
    "answer": 1
  },
  {
    "id": 101,
    "question": "What is the Sync network on Appliances used for?",
    "choices": [
      "May be used for any purpose, but synchronization always have priority",
      "To synchronize configurations and connections in between connection tables of different Appliances",
      "To transfer configuration files from Orchestrators to Appliances",
      "To transfer data in case of full utilization of the downlink interfaces"
    ],
    "answer": 1
  },
  {
    "id": 102,
    "question": "Complete the sentence: When using a Break-out cable...",
    "choices": [
      "All tails of the break-out cable must represent the same type of ports",
      "All tails of the break-out cable must represent uplinks",
      "Each tail of the break-out cable represent an independent port",
      "All tails of the break-out cable must represent downlinks"
    ],
    "answer": 2
  },
  {
    "id": 103,
    "question": "What cannot be learned from the output of asg monitor command?",
    "choices": [
      "Appliances cluster status",
      "Port status",
      "Uptime",
      "Security Policy status"
    ],
    "answer": 1
  },
  {
    "id": 104,
    "question": "When running ifconfig command on an Appliance, there are interfaces shown in the list: eth1-Sync and eth2-Sync. What is the purpose of theseinterfaces?",
    "choices": [
      "These interfaces are bond members (slaves) of Sync Bond",
      "These interfaces can be used as backup for Sync interface",
      "These interfaces are not in use, Security GW module use Sync interface for synchronization",
      "These interfaces represent physical Sync interface at the front panel of appliance"
    ],
    "answer": 3
  },
  {
    "id": 105,
    "question": "What cannot be a reason for DETACHED status of Appliance when running asg monitor command?",
    "choices": [
      "Appliance reboots",
      "Appliance is a member of Security Group, but currently disconnected",
      "Appliance installed with R80.20",
      "There an issue with Downlink cable"
    ],
    "answer": 2
  },
  {
    "id": 106,
    "question": "What is the minimal requirement for a Security Group?",
    "choices": [
      "1 Appliance and 1 management port",
      "2 Appliances and 2 ports",
      "1 Appliance and 1 administrator with Multi-Domain admin permissions",
      "None, it may be empty."
    ],
    "answer": 0
  }
];

const el = (sel)=>document.querySelector(sel);
const quizEl = el('#quiz');
const scoreBanner = el('#scoreBanner');
const modeEl = el('#mode');
const countEl = el('#count');
const toggleReviewBtn = el('#toggleReviewBtn');
const confirmBtn = el('#confirmBtn');
const nextBtn = el('#nextBtn');
const submitBtn = el('#submitBtn');
const prevBtn = el('#prevBtn');
const footerCard = el('#footerCard');
const rangeFromEl = el('#rangeFrom');
const rangeToEl = el('#rangeTo');
const searchWrap = el('#searchWrap');
const searchInput = el('#searchInput');
const searchBtn = el('#searchBtn');
const clearSearchBtn = el('#clearSearchBtn');
const countWrap = el('#countWrap');
const rangeWrap = el('#rangeWrap');
const toggleOriginal = el('#toggleOriginal');

let started = false;
let order = [];
let answers = {};

function updateSubmitState(){
  // Lock submit button until every question has an answer
  const allAnswered = started && order.length>0 && order.every((q,i)=> answers[i]!==undefined && answers[i]!==null);
  submitBtn.classList.toggle('disabled', !allAnswered);
  submitBtn.disabled = !allAnswered;
  submitBtn.setAttribute('aria-disabled', String(!allAnswered));
  submitBtn.title = allAnswered ? '' : '尚有未作答題目，完成全部題目後才能交卷';

}
let revealed = {};
let locked = {};
let idx = 0;

const OLD_WRONG_KEY = "ccse_wrong_ids";
const OLD_MARK_KEY  = "ccse_mark_ids";
const REVIEW_KEY    = "ccse_review_ids";
const STATS_KEY     = "ccse_stats";
const SHOW_ORIG_KEY = "ccse_show_orig";
(function migrate(){
  try {
    const existing = JSON.parse(localStorage.getItem(REVIEW_KEY) || "[]");
    if (!existing || existing.length === 0){
      const oldWrong = JSON.parse(localStorage.getItem(OLD_WRONG_KEY) || "[]");
      const oldMark  = JSON.parse(localStorage.getItem(OLD_MARK_KEY)  || "[]");
      const merged = Array.from(new Set([...(oldWrong||[]), ...(oldMark||[])]));
      if (merged.length){
        localStorage.setItem(REVIEW_KEY, JSON.stringify(merged));
      }
    }
  } catch(e){}
})();
const reviewSet = new Set(JSON.parse(localStorage.getItem(REVIEW_KEY) || "[]"));
let stats = {};
try { stats = JSON.parse(localStorage.getItem(STATS_KEY) || "{}"); } catch(e){ stats = {}; }
try { toggleOriginal.checked = JSON.parse(localStorage.getItem(SHOW_ORIG_KEY) || "false"); } catch(e){}

function updateHdr(){
  el('#hdrMeta').textContent = `題庫：${BANK.length} 題｜複習清單：${reviewSet.size}`;
  const mode = modeEl.value;
  footerCard.classList.toggle('hidden', !started || mode==='review_list_all' || mode==='search');
  countWrap.classList.toggle('hidden', !(mode==='exam' || mode==='review_list'));
  rangeWrap.classList.toggle('hidden', !(mode==='exam' || mode==='review_list'));
  searchWrap.classList.toggle('hidden', mode!=='search');
  scoreBanner.classList.add('hidden');
}

function persist(){
  localStorage.setItem(REVIEW_KEY, JSON.stringify(Array.from(reviewSet)));
  localStorage.setItem(STATS_KEY, JSON.stringify(stats));
  localStorage.setItem(SHOW_ORIG_KEY, JSON.stringify(toggleOriginal.checked));
  updateHdr();
}

function applyRange(pool){
  const fromV = parseInt(rangeFromEl.value||"");
  const toV = parseInt(rangeToEl.value||"");
  if(!isNaN(fromV) && !isNaN(toV)){
    const lo = Math.min(fromV, toV);
    const hi = Math.max(fromV, toV);
    return pool.filter(q => (q.id||0) >= lo && (q.id||0) <= hi);
  }
  return pool;
}

function buildQStats(qid){
  const s = stats[qid] || {attempts:0, correct:0, wrong:0};
  return `<span class="qstats">【作答次數: ${s.attempts}｜答對: ${s.correct}｜答錯: ${s.wrong}】</span>`;
}

function cleanQuestion(text){
  const re = /^\s*(question\s*#?\s*\d+\s*[:.)-]?\s*)/i;
  return text.replace(re, '');
}

function computeBasePool(){
  let base = [];
  if (modeEl.value === 'review_list' || modeEl.value === 'review_list_all') {
    base = BANK.filter(q=>reviewSet.has(q.id));
  } else {
    base = BANK.slice();
  }
  if (modeEl.value !== 'review_list_all' && modeEl.value !== 'search') base = applyRange(base);
  return base;
}

function showPreStartSummary(){
  const mode = modeEl.value;
  const n = parseInt(countEl.value,10);
  const base = computeBasePool();
  const poolSize = base.length;
  const fromV = rangeFromEl.value ? parseInt(rangeFromEl.value) : null;
  const toV = rangeToEl.value ? parseInt(rangeToEl.value) : null;
  const rangeTxt = (fromV && toV) ? `${Math.min(fromV,toV)}–${Math.max(fromV,toV)}` : '全部';
  const willUse = (mode==='exam' || mode==='review_list') ? Math.min(n, poolSize) : poolSize;

  const modeLabel = {exam:'Exam（考試模式）', review_list:'Review List（隨機）', review_list_all:'Review List（全部）', search:'Search'}[mode];

  const lines = [
    `<div>模式：<b>${modeLabel}</b></div>`,
    (mode==='search') ? `<div>說明：本模式需輸入關鍵字後按「搜尋」。</div>` : '',
    (mode!=='search' && mode!=='review_list_all') ? `<div>題號範圍：<b>${rangeTxt}</b></div>` : '',
    `<div>可用題數：<b>${poolSize}</b></div>`,
    (mode==='exam' || mode==='review_list') ? `<div>本次題數：<b>${willUse}</b></div>` : '',
  ].join('');

  quizEl.innerHTML = `
    <div class="card">
      <div class="summary">
        <div style="font-weight:600;">開始前摘要</div>
        ${lines}
        <div style="margin-top:8px; display:flex; gap:8px;">
          <button class="btn" id="confirmStartBtn">確認開始</button>
          <button class="btn secondary" id="cancelStartBtn">取消</button>
        </div>
      </div>
    </div>`;

  el('#confirmStartBtn').addEventListener('click', ()=>{
    started = true;
    startActual();
  });
  el('#cancelStartBtn').addEventListener('click', ()=>{
    started = false;
    render();
  });
}

function start(){ started = false; showPreStartSummary(); }

function startActual(){
  answers = {}; revealed = {}; locked = {}; idx = 0;
  scoreBanner.classList.add('hidden');

  const base = computeBasePool();

  if (modeEl.value === 'review_list_all' || modeEl.value === 'search') {
    order = base.slice().sort((a,b)=> (a.id||0)-(b.id||0));
    started = true;
    render();
  } else {
    const n = parseInt(countEl.value,10);
    order = base.slice();
    order = order.sort(()=>Math.random()-0.5).slice(0, Math.min(n, order.length)).map(q => ({...q}));
    if (modeEl.value === 'exam'){
      order = order.map(q => {
        const idxs = [0,1,2,3];
        idxs.sort(()=>Math.random()-0.5);
        const newChoices = idxs.map(i => q.choices[i]);
        const newAnswer = idxs.indexOf(q.answer);
        return {...q, choices:newChoices, answer:newAnswer};
      });
    }
    started = true;
    render();
  }
}

function onPick(i, choice){
  if (!started) return;
  if (locked[i]) return;
  answers[i] = choice;
  render();
}

function confirmCurrent(){
  if (!started) return;
  const q = order[idx];
  if (!q) return;
  if (revealed[idx]) return;
  const a = answers[idx];
  if (a === undefined) return;
  revealed[idx] = true;
  locked[idx] = true;
  if (!stats[q.id]) stats[q.id] = {attempts:0, correct:0, wrong:0};
  stats[q.id].attempts += 1;
  const outcome = (a === q.answer) ? 'correct' : 'wrong';
  stats[q.id][outcome] += 1;
  if (outcome === 'wrong') reviewSet.add(q.id);
  persist();
  render();
  updateSubmitState();
}


function goNext(){ if (started && revealed[idx] && idx < order.length - 1){ idx += 1; render(); } }
function goPrev(){ if (started && idx > 0){ idx -= 1; render(); } }

function render(){
  const mode = modeEl.value;
  updateHdr();
  if (!started){
    quizEl.innerHTML = `<div class="card"><div class="qtxt">按「開始」後會先顯示本次小測驗摘要。</div></div>`;
    updateSubmitState();
    return;
  }
  if (mode === 'review_list_all'){
    if(order.length===0){
      quizEl.innerHTML = `<div class="card"><div class="qtxt">目前「複習清單」是空的。</div></div>`;
      return;
    }
    quizEl.innerHTML = order.map((q,i)=> renderListCard(q, i, order.length)).join("");
    wireListControls();
    return;
  }
  if (mode === 'search'){
    const query = searchInput.value.trim();
    if(!query){
      quizEl.innerHTML = `<div class="card"><div class="qtxt">請輸入關鍵字再按「搜尋」。支援多關鍵字（以空白分隔）。</div></div>`;
      return;
    }
    const toks = query.split(/\s+/).map(s=>s.toLowerCase());
    const matches = order.filter(q=> toks.every(t=> (q.question+" "+q.choices.join(" ")).toLowerCase().includes(t)));
    if (matches.length===0){
      quizEl.innerHTML = `<div class="card"><div class="qtxt">沒有符合的題目。</div></div>`;
      return;
    }
    quizEl.innerHTML = matches.map((q,i)=> renderListCard(q, i, matches.length)).join("");
    wireListControls();
    return;
  }
  const q = order[idx];
  if(!q){
    quizEl.innerHTML = `<div class="card"><div class="qtxt">沒有符合條件的題目。請調整題號範圍或切換模式。</div></div>`;
    return;
  }
  const a = answers[idx];
  const isRevealed = !!revealed[idx];
  const isLocked = !!locked[idx];
  const choiceHTML = q.choices.map((c,k)=>{
    const chosen = (a === k);
    let cls = "choice";
    if (isLocked) cls += " locked";
    if (chosen) cls += " selected";
    if (isRevealed){
      if (k === q.answer) cls += " correct";
      if (chosen && k !== q.answer) cls += " wrong";
    }
    return `<div class="${cls}" data-k="${k}"><b>${(k+1)}</b>. ${c.replace(/</g,"&lt;")}</div>`;
  }).join("");
  const origIdHtml = toggleOriginal.checked ? `<div class="pill">原始ID #${q.id}</div>` : "";
  const cleaned = cleanQuestion(q.question).replace(/</g,"&lt;");
  quizEl.innerHTML = `
    <div class="card">
      <div class="qhead">
        <div class="qid">題目 ${idx+1} / ${order.length}</div>
        ${origIdHtml}
      </div>
      <div class="qstats">${buildQStats(q.id)}</div>
      <div class="qtxt">${cleaned}</div>
      <div class="choices">${choiceHTML}</div>
    </div>`;
  quizEl.querySelectorAll('.choice').forEach(ch=>{
    ch.addEventListener('click', ()=>{
      const k = parseInt(ch.dataset.k);
      onPick(idx, k);
    });
  });
  prevBtn.classList.toggle('disabled', idx===0);
  nextBtn.classList.toggle('disabled', idx===order.length-1 || !isRevealed);
  confirmBtn.classList.toggle('disabled', isRevealed || a===undefined);
  const inReview = reviewSet.has(q.id);
  toggleReviewBtn.classList.toggle('active', inReview);
  toggleReviewBtn.textContent = inReview ? '已在複習清單（5）' : '加入/移出複習清單（5）';
  try{ confirmBtn.blur(); nextBtn.blur(); prevBtn.blur(); toggleReviewBtn.blur(); }catch(e){}
}  updateSubmitState();


function renderListCard(q, i, total){
  const s = stats[q.id] || {attempts:0, correct:0, wrong:0};
  const choices = q.choices.map((c,k)=>{
    const isCorrect = (k===q.answer);
    const cls = "choice" + (isCorrect ? " correct":"");
    return `<div class="${cls}"><b>${(k+1)}</b>. ${c.replace(/</g,"&lt;")}</div>`;
  }).join("");
  const origIdHtml = toggleOriginal.checked ? `<div class="pill">原始ID #${q.id}</div>` : "";
  const cleaned = cleanQuestion(q.question).replace(/</g,"&lt;");
  return `
  <div class="card" data-qid="${q.id}">
    <div class="qhead">
      <div class="qid">題目 ${i+1} / ${total}</div>
      ${origIdHtml}
    </div>
    <div class="qstats">【作答次數: ${s.attempts}｜答對: ${s.correct}｜答錯: ${s.wrong}】</div>
    <div class="qtxt">${cleaned}</div>
    <div class="choices">${choices}</div>
    <div class="inline-controls" style="margin-top:10px;">
      <button class="btn danger" data-action="removeReview">移出複習清單</button>
    </div>
  </div>`;
}

function wireListControls(){
  quizEl.querySelectorAll('.card').forEach(card=>{
    const qid = parseInt(card.dataset.qid,10);
    const removeBtn = card.querySelector('[data-action="removeReview"]');
    if(removeBtn){
      removeBtn.addEventListener('click', ()=>{
        reviewSet.delete(qid);
        persist();
        card.remove();
      });
    }
  });
}

function submit(){
  if (!started) return;
  if (submitBtn.disabled || submitBtn.classList.contains('disabled')) return;
  const total = order.length;
  let correct = 0;
  let unanswered = 0;
  const results = [];
  order.forEach((q,i)=>{
    const aRaw = answers[i];
    const hasAnswer = (aRaw !== undefined && aRaw !== null);
    const a = hasAnswer ? Number(aRaw) : undefined;
    const ok = hasAnswer && (a === Number(q.answer));
    if (!hasAnswer) unanswered += 1;
    if (ok) correct += 1;

    // Update per-question stats at submission time (so you don't need to press 「確認」 to record attempts)
    if (!stats[q.id]) stats[q.id] = {attempts:0, correct:0, wrong:0};
    if (hasAnswer){
      stats[q.id].attempts += 1;
      if (ok) stats[q.id].correct += 1;
      else stats[q.id].wrong += 1;
    }
results.push({q, a, ok, hasAnswer});
  });
  persist();

  const pct = (total ? (correct/total*100) : 0);
  const note = unanswered ? `｜未作答：${unanswered}` : '';
  scoreBanner.textContent = `本次成績：${correct}/${total}（${pct.toFixed(1)}%）${note}`;
  scoreBanner.classList.remove('hidden');

  quizEl.innerHTML = results.map(({q,a,ok,hasAnswer},i)=>{
    const s = stats[q.id] || {attempts:0, correct:0, wrong:0};
    const choices = q.choices.map((c,k)=>{
      const isCorrect = (k===q.answer);
      const chosen = (a === k);
      let cls = "choice";
      if (isCorrect) cls += " correct";
      if (chosen && !isCorrect) cls += " wrong";
      if (chosen) cls += " selected";
      return `<div class="${cls}"><b>${(k+1)}</b>. ${c.replace(/</g,"&lt;")}</div>`;
    }).join("");
    const origIdHtml = toggleOriginal.checked ? `<div class="pill">原始ID #${q.id}</div>` : "";
    const cleaned = cleanQuestion(q.question).replace(/</g,"&lt;");
    const showRemove = (!ok) || reviewSet.has(q.id);
    const controls = showRemove ? `<div class="inline-controls" style="margin-top:10px;">
        <button class="btn danger" data-action="removeReview" data-qid="${q.id}">移出複習清單</button>
      </div>` : "";
    const warn = (!hasAnswer) ? `<div class="pill" style="margin-top:10px; border-color:#a33; background:#2a1111;">本題未作答（以錯誤計）</div>` : "";
    return `
    <div class="card" data-qid="${q.id}">
      <div class="qhead">
        <div class="qid">題目 ${i+1} / ${order.length}</div>
        ${origIdHtml}
      </div>
      <div class="qstats">【作答次數: ${s.attempts}｜答對: ${s.correct}｜答錯: ${s.wrong}】</div>
      <div class="qtxt">${cleaned}</div>
      <div class="choices">${choices}</div>
      ${warn}
      ${controls}
    </div>`;
  }).join("");

  quizEl.querySelectorAll('[data-action="removeReview"]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const qid = parseInt(btn.getAttribute('data-qid'),10);
      reviewSet.delete(qid);
      persist();
      btn.closest('.card')?.remove();
    });
  });
}

function toggleReviewForCurrent(){
  const q = order[idx];
  if(!q) return;
  if (reviewSet.has(q.id)) reviewSet.delete(q.id);
  else reviewSet.add(q.id);
  persist();
  render();
}
toggleReviewBtn.addEventListener('click', (e)=>{ toggleReviewForCurrent(); try{e.currentTarget.blur();}catch(err){} });

document.addEventListener('keydown', (e)=>{
  const t = e.target;
  const tag = (t && t.tagName) ? t.tagName.toLowerCase() : '';
  const isTyping = (tag==='input' || tag==='textarea' || tag==='select' || (t && t.isContentEditable));
  if (isTyping) return;

  if (!started) return;
  const mode = modeEl.value;
  if (mode==='exam' || mode==='review_list'){
    if (['1','2','3','4'].includes(e.key)){
      e.preventDefault(); e.stopPropagation();
      onPick(idx, parseInt(e.key)-1);
    } else if (e.key === '5' && mode==='exam'){
      e.preventDefault(); e.stopPropagation();
      toggleReviewForCurrent();
    } else if (e.key === 'Enter'){
      e.preventDefault(); e.stopPropagation();
      confirmCurrent();
    } else if (e.key === 'ArrowRight'){
      e.preventDefault(); e.stopPropagation();
      goNext();
    } else if (e.key === 'ArrowLeft'){
      e.preventDefault(); e.stopPropagation();
      goPrev();
    }
  }
});

el('#startBtn').addEventListener('click', ()=>{ started=false; showPreStartSummary(); });
el('#resetBtn').addEventListener('click', ()=>{
  answers = {}; revealed = {}; locked = {}; idx = 0; started = false;
  reviewSet.clear();
  stats = {};
  localStorage.removeItem(REVIEW_KEY);
  localStorage.removeItem(STATS_KEY);
  persist();
  render();
});
prevBtn.addEventListener('click', goPrev);
nextBtn.addEventListener('click', goNext);
confirmBtn.addEventListener('click', confirmCurrent);
submitBtn.addEventListener('click', submit);
el('#exportReviewBtn').addEventListener('click', ()=>{
  const ids = Array.from(reviewSet);
  const blob = new Blob([JSON.stringify(ids, null, 2)], {type:"application/json"});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'ccse_review_ids.json';
  a.click();
});

modeEl.addEventListener('change', ()=>{
  answers = {}; revealed = {}; locked = {}; idx = 0;
  order = [];
  scoreBanner.classList.add('hidden');
  const mode = modeEl.value;
  if (mode === 'review_list_all') {
    started = true;
    const base = BANK.filter(q=>new Set(JSON.parse(localStorage.getItem('ccse_review_ids')||'[]')).has(q.id));
    order = base.slice().sort((a,b)=> (a.id||0)-(b.id||0));
    render();
  } else {
    started = false;
    render();
  }
});

toggleOriginal.addEventListener('change', ()=>{ persist(); render(); });
searchBtn.addEventListener('click', ()=>{
  if (!started){ started=true; startActual(); }
  order = BANK.slice().sort((a,b)=> (a.id||0)-(b.id||0));
  render();
});
clearSearchBtn.addEventListener('click', ()=>{
  searchInput.value = "";
  render();
});

updateHdr();
render();
</script>
</body>
</html>
